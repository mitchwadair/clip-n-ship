var ClipConverter=(()=>{var l=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var y=(a,e)=>{for(var t in e)l(a,t,{get:e[t],enumerable:!0})},w=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of u(e))!_.call(a,s)&&s!==t&&l(a,s,{get:()=>e[s],enumerable:!(r=v(e,s))||r.enumerable});return a};var p=a=>w(l({},"__esModule",{value:!0}),a);var f={};y(f,{default:()=>m});var c=class{constructor(e,t=1080,r=1920){if(!e)throw new Error("Must include video data when instantiating a ClipConverter");this._layers=[],this._dimensions={width:t,height:r},this._canvas=this._createCanvas(),this._video=this._createVideo(e),this._playInterval}_createCanvas(){let{width:e,height:t}=this._dimensions,r=document.createElement("canvas");return r.setAttribute("id","clipnship-canvas"),r.setAttribute("width",e),r.setAttribute("height",t),r}_createVideo(e){let t=document.createElement("video");return t.setAttribute("hidden",""),t.setAttribute("src",e),t.onplay=()=>{clearInterval(this._playInterval),this._playInterval=setInterval(()=>this._drawLayers(),1e3/60)},t.onpause=()=>clearInterval(this._playInterval),t.onended=()=>clearInterval(this._playInterval),t.onloadedmetadata=()=>t.currentTime=0,t.onseeked=()=>window.requestAnimationFrame(()=>this._drawLayers()),t}_calculateRenderValues(e=1){let{width:t,height:r}=this._dimensions,s,n,o,i;t>r?(s=o=t,n=i=r):(s=o=r,n=i=t);let h=(t-o*e)/2,d=(r-i*e)/2;return{offsetX:h,offsetY:d,width:s*e,height:n*e}}_drawLayers(){let e=this._canvas.getContext("2d");for(let t=0;t<this._layers.length;t++){let{source:r,scale:s,filter:n}=this._layers[t],{offsetX:o,offsetY:i,width:h,height:d}=this._calculateRenderValues(s);e.filter=n,e.drawImage(r,o,i,h,d)}}getPreview(e="500px"){return this._canvas.style=`width: ${e}`,this._canvas}addLayer(e,t,r="none"){if(this.getLayer(e))throw new Error(`Layer with name "${e}" already exists`);return this._layers.push({name:e,scale:t,filter:r,source:this._video}),this._drawLayers(),this._layers}getLayer(e){return this._layers.find(t=>t.name===e)}removeLayer(e){return this._layers=this._layers.filter(t=>t.name!==e),this._drawLayers(),this._layers}getLayers(){return this._layers}updateLayerScale(e,t){let r=this.getLayer(e);if(r)r.scale=t,this._drawLayers();else throw new Error(`Layer with name "${e}" not found`);return this._layers}updateLayerFilter(e,t){let r=this.getLayer(e);if(r)r.filter=t,this._drawLayers();else throw new Error(`Layer with name "${e}" not found`);return this._layers}previewPlay(){this._video.play()}previewPause(){this._video.pause()}previewReset(){this.previewPause(),this._video.currentTime=0}render(e,t,r=()=>{}){let s=this._canvas.captureStream(e),n=this._video.captureStream(e),o=new MediaStream([...s.getVideoTracks(),...n.getAudioTracks()]),i=new MediaRecorder(o,{mimeType:"video/webm;codecs=vp9"}),h=[];i.ondataavailable=d=>{h.push(d.data),r(this._video.currentTime/this._video.duration)},i.onstop=()=>{this._video.volume=1,t(new Blob(h,{type:"video/webm;codecs=vp9"}))},this.previewReset(),this._video.volume=.001,i.start(500),this._video.play(),this._video.onended=()=>{clearInterval(this._playInterval),i.stop()}}},m=c;return p(f);})();
//# sourceMappingURL=clipnship.min.js.map
